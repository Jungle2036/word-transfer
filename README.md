# Excel集成Word文档生成器

一个基于Node.js的命令行工具，用于从Excel文件读取产品编码并生成包含随机数据的Word文档。该工具支持自动分页、产品编码集成和高性能处理。

## 功能特性

- 📊 **Excel集成**: 从Excel文件第四列读取产品编码
- 📄 **Word文档生成**: 使用模板生成包含数据的Word文档
- 🔄 **自动分页**: 每页固定20行，自动计算总页数
- 🎲 **随机数据生成**: 生成符合特定分布的随机数值
- ⚡ **性能优化**: 支持处理大量数据（10000+行）
- 🌐 **多语言支持**: 支持Unicode字符和特殊字符
- 💻 **跨平台**: 支持Windows、macOS和Linux
- 🔧 **灵活配置**: 支持命令行参数和交互式模式

## 安装

### 环境要求

- Node.js 14.0 或更高版本
- npm 或 pnpm

### 安装依赖

```bash
# 使用npm
npm install

# 或使用pnpm
pnpm install
```

## 使用方法

### 命令行模式

```bash
# 基本用法
node word.js --template=template.docx --excel=data.xlsx --output=result

# 使用短参数
node word.js -t template.docx -e data.xlsx -o result

# 使用等号形式
node word.js --template=template.docx --excel=data.xlsx --output=result
```

### 交互式模式

直接运行程序，按提示输入参数：

```bash
node word.js
```

程序会依次询问：

- 模板文件路径（默认：template.docx）
- Excel文件路径（默认：test.xlsx）
- 输出文件名前缀（默认：output）

## 参数说明

| 参数 | 短参数 | 描述 | 默认值 |
|------|--------|------|--------|
| `--template` | `-t` | Word模板文件路径 | template.docx |
| `--excel` | `-e` | Excel数据文件路径 | test.xlsx |
| `--output` | `-o` | 输出文件名前缀 | output |

## Excel文件格式要求

Excel文件必须满足以下格式：

1. **第一行为表头**（内容不限）
2. **第四列包含产品编码**（从第二行开始）
3. **支持的格式**：.xlsx 和 .xls
4. **编码要求**：产品编码不能为空

### 示例Excel格式

| 列1 | 列2 | 列3 | 产品编码 |
|-----|-----|-----|----------|
| 数据1 | 数据2 | 数据3 | PROD001 |
| 数据1 | 数据2 | 数据3 | PROD002 |
| 数据1 | 数据2 | 数据3 | PROD003 |

## Word模板要求

模板文件需要包含以下占位符：

### 单页模板（向后兼容）

```
{{#errors}}
Q1: {{q1}}, Q2: {{q2}}, Q3: {{q3}}, 产品编码: {{q4}}
{{/errors}}
```

### 多页模板（推荐）

```
{{#pages}}
第{{pageIndex}}页
{{#errors}}
Q1: {{q1}}, Q2: {{q2}}, Q3: {{q3}}, 产品编码: {{q4}}
{{/errors}}
{{/pages}}

{{#pagesRest}}
{{#errors}}
Q1: {{q1}}, Q2: {{q2}}, Q3: {{q3}}, 产品编码: {{q4}}
{{/errors}}
{{/pagesRest}}
```

## 数据结构说明

生成的数据包含以下字段：

- **q1, q2, q3**: 随机数值（-2.0到2.0，一位小数）
  - 80%概率在[-1.0, 1.0]范围内
  - 20%概率在[-2.0, -1.0)或(1.0, 2.0]范围内
- **q4**: 从Excel文件读取的产品编码

## 性能特性

- **内存优化**: 直接访问Excel单元格，避免全量加载
- **处理能力**: 支持10000+行数据处理
- **处理速度**: 1000行数据约30ms处理时间
- **内存占用**: 平均每行数据约3KB内存占用

## 构建可执行文件

项目支持构建为独立可执行文件：

```bash
# 构建所有平台
npm run build

# 构建特定平台
npm run build:win    # Windows
npm run build:mac    # macOS
npm run build:linux  # Linux
```

构建后的文件位于 `dist/` 目录。

## 错误处理

程序提供详细的错误信息和用户指导：

### 常见错误及解决方案

1. **Excel文件不存在**

   ```
   ❌ Excel文件处理错误: Excel文件不存在: data.xlsx
   💡 请检查: Excel文件路径是否正确
   ```

2. **不支持的文件格式**

   ```
   ❌ Excel文件处理错误: 不支持的文件格式: .txt，请使用.xlsx或.xls格式
   ```

3. **没有产品编码数据**

   ```
   ❌ Excel文件处理错误: Excel文件第四列中没有找到有效的产品编码数据
   💡 请检查: 第四列是否包含产品编码数据
   ```

4. **模板文件不存在**

   ```
   ❌ 模板文件错误: 未找到模板文件: template.docx
   💡 请检查模板文件路径是否正确
   ```

## 输出文件

生成的Word文档文件名格式：

```
{输出前缀}-{时间戳}.docx
```

例如：`output-20240315-143022.docx`

## 技术栈

- **Node.js**: 运行环境
- **docxtemplater**: Word文档模板处理
- **pizzip**: ZIP文件处理
- **xlsx**: Excel文件读取
- **pkg**: 可执行文件打包

## 版本历史

### v1.0.0

- ✅ Excel文件读取功能
- ✅ 自动分页计算
- ✅ Word文档生成
- ✅ 命令行参数支持
- ✅ 交互式模式
- ✅ 性能优化
- ✅ 错误处理
- ✅ 向后兼容性

## 许可证

ISC License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 支持

如果遇到问题，请：

1. 检查Excel文件格式是否正确
2. 确认模板文件存在且格式正确
3. 查看错误信息中的具体指导
4. 运行测试文件验证环境配置

---

**注意**: 在Windows平台上，双击运行程序时会在完成后暂停，方便查看结果。按回车键退出。
